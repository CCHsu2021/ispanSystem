@addTagHelper *, MSITTeam1
@model MSITTeam1.ViewModels.CStudentResumeViewModel

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap" rel="stylesheet">

<div class="resumebar">
    <div class="pagination-container full-width-container">
        <div class="sized-container">
            <div class="pagination"></div>
        </div>
    </div>
    <div class="viewport full-width-container">
        <ul class="slide-container">
            <li class="slide" data-tag="基本資料">
                <form name="basic">
                    <div class="sized-container basic">
                        <div class="row data">
                            <div class="col-4">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                                <input type="hidden" asp-for="MemberId" id="MemberId" name="MemberId" />
                                <div class="form-group">
                                    <label asp-for="fName" class="control-label"></label>
                                    <input id="fName" asp-for="fName" class="form-control" name="fName" />
                                    <span asp-validation-for="fName" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="fGender" class="control-label"></label>
                                    <input id="fGender" asp-for="fGender" class="form-control" type="text" name="fGender" />
                                    <span asp-validation-for="fGender" class="text-danger"></span>

                                </div>
                                <div class="form-group">
                                    <label asp-for="fBirthDate" class="control-label"></label>
                                    <input id="fBirthDate" asp-for="fBirthDate" class="form-control" type="text" name="fBirthDate" />
                                    <span asp-validation-for="fBirthDate" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label asp-for="fEmail" class="control-label"></label>
                                    <input id="fEmail" asp-for="fEmail" class="form-control" name="fEmail" />
                                    <span asp-validation-for="fEmail" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="fPhone" class="control-label"></label>
                                    <input id="fPhone" asp-for="fPhone" class="form-control" name="fPhone" />
                                    <span asp-validation-for="fPhone" class="text-danger"></span>
                                </div>
                                <div class="form-group">
                                    <label asp-for="fAddress" class="control-label"></label>
                                    <div>

                                        <vc:selector city="@Model.fCity" district="@Model.fDistrict"></vc:selector>
                                    </div>
                                    <input id="fAddress" asp-for="fAddress" class="form-control" name="fAddress" />
                                    <span asp-validation-for="fAddress" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="image-upload">
                                    <label for="file-input">
                                        <img id="blah" class="img-thumbnail" src="/images/student/@Model.fPortrait" title="變更圖片" alt="您的圖片" />
                                    </label>
                                    <input id="file-input" type="file" name="photo" />
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="fAutobiography" class="control-label"></label>
                            <textarea id="fAutobiography" asp-for="fAutobiography" class="form-control" name="fAutobiography"> </textarea>
                            <span asp-validation-for="fAutobiography" class="text-danger"></span>
                        </div>
                        <div class="btndiv">
                            <button class="savebtn my-3" id="savechanges">儲存</button>
                        </div>
                    </div>
                </form>
            </li>

            <li class="slide" data-tag="經歷">
                <div class="sized-container">
                    <div class="row data" id="workExpPage">
                        <div class="col-6">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                            <input type="hidden" asp-for="MemberId" id="MemberId" />
                            <input type="hidden" asp-for="WorkExperienceId" id="WorkExperienceId" />
                            <div class="form-group">
                                <label asp-for="CompanyName" class="control-label"></label>
                                <input id="CompanyName" asp-for="CompanyName" class="form-control" />
                                <span asp-validation-for="CompanyName" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="CompanyDepartment" class="control-label"></label>
                                <input id="CompanyDepartment" asp-for="CompanyDepartment" class="form-control" type="text" />
                                <span asp-validation-for="CompanyDepartment" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="JobTitle" class="control-label"></label>
                                <input id="JobTitle" asp-for="JobTitle" class="form-control" type="text" />
                                <span asp-validation-for="JobTitle" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="EmploymentFrom" class="control-label"></label>
                                <input id="EmploymentFrom" asp-for="EmploymentFrom" class="form-control" />
                                <span asp-validation-for="EmploymentFrom" class="text-danger"></span>
                            </div>
                            <button class="creatworkbtn my-3" id="createWork">新增</button>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label asp-for="EmploymentTo" class="control-label"></label>
                                <input id="EmploymentTo" asp-for="EmploymentTo" class="form-control" />
                                <span asp-validation-for="EmploymentTo" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="JobDescription" class="control-label"></label>
                                <textarea id="JobDescription" asp-for="JobDescription" class="form-control"></textarea>
                                <span asp-validation-for="JobDescription" class="text-danger"></span>
                            </div>
                            <button class="saveworkbtn my-3" id="editWork" onclick="editWork()">儲存修改</button>
                        </div>
                    </div>

                    <div class="card workdata">
                        <vc:student-work-experience></vc:student-work-experience>
                    </div>
                </div>
            </li>

            <li class="slide" data-tag="學歷">
                <div class="sized-container edu">
                    <div class="row data" id="EduPage">
                        <div class="col-6">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <input type="hidden" asp-for="MemberId" id="MemberId" />
                            <input type="hidden" asp-for="EducationId" id="EducationId" />
                            <div class="form-group">
                                <label asp-for="GraduateSchool" class="control-label"></label>
                                <input id="GraduateSchool" asp-for="GraduateSchool" class="form-control" />
                                <span asp-validation-for="GraduateSchool" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="GraduateDepartment" class="control-label"></label>
                                <input id="GraduateDepartment" asp-for="GraduateDepartment" class="form-control" type="text" />
                                <span asp-validation-for="GraduateDepartment" class="text-danger"></span>
                            </div>

                            <button class="creatworkbtn my-3" id="createEdu">新增</button>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label asp-for="StudyFrom" class="control-label"></label>
                                <input id="StudyFrom" asp-for="StudyFrom" class="form-control" />
                                <span asp-validation-for="StudyFrom" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label asp-for="StudyTo" class="control-label"></label>
                                <input id="StudyTo" asp-for="StudyTo" class="form-control">
                                <span asp-validation-for="StudyTo" class="text-danger"></span>
                            </div>
                            <button class="saveworkbtn my-3" id="editEdu" onclick="editEdu()">儲存修改</button>
                        </div>
                    </div>

                    <div class="card workdata">
                        <vc:student-education></vc:student-education>
                    </div>

                </div>

            </li>
            <li class="slide" data-tag="語言">
                <div class="sized-container">
                    <h1>Tell us about where you've worked before.</h1>
                    <h2>Information about this section.</h2>
                </div>
            </li>
            <li class="slide" data-tag="技能">
                <div class="sized-container">
                    <h1>Describe your formal education.</h1>
                    <h2>Information about this section.</h2>
                </div>
            </li>
            <li class="slide" data-tag="作品">
                <div class="sized-container">
                    <h1>Mention any additional comments.</h1>
                    <h2>Information about this section.</h2>
                </div>
            </li>
            <li class="slide" data-tag="樣式">
                <div class="sized-container">
                    <h1>Confirm your application.</h1>
                    <h2>Information about this section.</h2>
                </div>
            </li>
        </ul>
    </div>
    <div class="full-width-container ">
        <div class="button-container sized-container">
            <button class="next">下一步</button>
            <button class="previous">上一步</button>
        </div>
    </div>
</div>

@section Scripts
{
<script>
    var currentSlide = 0,
        $slideContainer = $('.slide-container'),
        $slide = $('.slide'),
        slideCount = $slide.length,
        animationTime = 300;

    function setSlideDimensions() {
        var windowWidth = $(window).width();
        $slideContainer.width(windowWidth * slideCount);
        $slide.width(windowWidth);
    }

    function generatePagination() {
        var $pagination = $('.pagination');
        for (var i = 0; i < slideCount; i++) {
            var $indicator = $('<div>').addClass('indicator'),
                $progressBarContainer = $('<div>').addClass('progress-bar-container'),
                $progressBar = $('<div>').addClass('progress-bar'),
                indicatorTagText = $slide.eq(i).attr('data-tag'),
                $tag = $('<div>').addClass('tag').text(indicatorTagText);
            $indicator.append($tag);
            $progressBarContainer.append($progressBar);
            $pagination.append($indicator).append($progressBarContainer);
        }
        $pagination.find('.indicator').eq(0).addClass('active');
    }

    function goToNextSlide() {
        if (currentSlide >= slideCount - 1) return;
        var windowWidth = $(window).width();
        currentSlide++;
        $slideContainer.animate({
            left: -(windowWidth * currentSlide)
        });
        setActiveIndicator();
        $('.progress-bar').eq(currentSlide - 1).animate({
            width: '100%'
        }, animationTime);
    }

    function goToPreviousSlide() {
        if (currentSlide <= 0) return;
        var windowWidth = $(window).width();
        currentSlide--;
        $slideContainer.animate({
            left: -(windowWidth * currentSlide)
        }, animationTime);
        setActiveIndicator();
        $('.progress-bar').eq(currentSlide).animate({
            width: '0%'
        }, animationTime);
    }

    function postitionSlides() {
        var windowWidth = $(window).width();
        setSlideDimensions();
        $slideContainer.css({
            left: -(windowWidth * currentSlide)
        }, animationTime);
    }

    function setActiveIndicator() {
        var $indicator = $('.indicator');
        $indicator.removeClass('active').removeClass('complete');
        $indicator.eq(currentSlide).addClass('active');
        for (var i = 0; i < currentSlide; i++) {
            $indicator.eq(i).addClass('complete');
        }
    }

    setSlideDimensions();
    generatePagination();
    $(window).resize(postitionSlides);
    $('.next').on('click', goToNextSlide);
    $('.previous').on('click', goToPreviousSlide);
    //圖片瀏覽
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {  //reader加載成功
                    $('#blah').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        $("#file-input").change(function () {
            readURL(this);
        });


    // 儲存基本資料
    const btn = document.querySelector('#savechanges');
    btn.addEventListener('click', (evt) => {
        evt.preventDefault();

        const formdata = new FormData(document.basic);
        var   CityChoice = $("#City option:selected").text();
        var   DistrictChoice = $("#District option:selected").text();
        formdata.append('fCity', CityChoice);
        formdata.append('fDistrict', DistrictChoice);

        fetch('@Url.Content("~/StudentResume/EditBasic")',{
            method:'POST',
            body:formdata,
        }).then(Swal.fire({

            icon: 'success',
            title: '修改成功',
            showConfirmButton: false,
            timer: 1500
        }))
        $("#row data").load("@Url.Content("~/StudentResume/Create")");
    })


    //工作新增
    $("#createWork").click(()=>{
         var jsondata = JSON.stringify({
        WorkMemberId:$("#MemberId").val(),
        CompanyName:$("#CompanyName").val(),
        CompanyDepartment:$("#CompanyDepartment").val(),
        JobTitle:$("#JobTitle").val(),
        EmploymentFrom:$("#EmploymentFrom").val(),
        EmploymentTo:$("#EmploymentTo").val(),
        JobDescription:$("#JobDescription").val()
        })

            $.ajax({
            url: "@Url.Content("~/StudentResume/CreateWork")",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            data: jsondata
         }).done(function (data) {
            Swal.fire({
                        icon: 'success',
                        title: '新增成功',
                        showConfirmButton: false,
                        timer: 1500
                        })
            $("#workPage").load(location.href + " #workPage");

        })
    })

    $("#editWork").hide();
    //工作儲存編輯
     function editWork()
     {
         var jsondata = JSON.stringify({
        WorkMemberId:$("#MemberId").val(),
        WorkExperienceId:$("#WorkExperienceId").val(),
        CompanyName:$("#CompanyName").val(),
        CompanyDepartment:$("#CompanyDepartment").val(),
        JobTitle:$("#JobTitle").val(),
        EmploymentFrom:$("#EmploymentFrom").val(),
        EmploymentTo:$("#EmploymentTo").val(),
        JobDescription:$("#JobDescription").val()
        })
        $.ajax({
            url:"@Url.Content("~/StudentResume/EditWork")",
            type:"POST",
            contentType:"application/json; chartset=utf-8",
            data:jsondata
        }).done(function (data) {
            Swal.fire({
                        icon: 'success',
                        title: '修改成功',
                        showConfirmButton: false,
                        timer: 1500
                        })
            $("#editWork").hide();
            $("#createWork").show();
            $("#workPage").load(location.href + " #workPage");
        })}

    //學歷新增
    $("#createEdu").click(()=>{
         var jsondata = JSON.stringify({
       EduMemberId:$("#MemberId").val(),
        GraduateSchool:$("#GraduateSchool").val(),
        GraduateDepartment:$("#GraduateDepartment").val(),
        StudyFrom:$("#StudyFrom").val(),
        StudyTo:$("#StudyTo").val()
        })

            $.ajax({
            url: "@Url.Content("~/StudentResume/CreateEdu")",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            data: jsondata
         }).done(function (data) {
            Swal.fire({
                        icon: 'success',
                        title: '新增成功',
                        showConfirmButton: false,
                        timer: 1500
                        })
            $("#eduPage").load(location.href + " #eduPage");

        })
    })

    $("#editEdu").hide();
    //學歷儲存編輯
     function editEdu()
     {
        var jsondata = JSON.stringify({
        EducationId:$("#EducationId").val(),
        GraduateSchool:$("#GraduateSchool").val(),
        GraduateDepartment:$("#GraduateDepartment").val(),
        StudyFrom:$("#StudyFrom").val(),
        StudyTo:$("#StudyTo").val()
        })
        $.ajax({
            url:"@Url.Content("~/StudentResume/EditEdu")",
            type:"POST",
            contentType:"application/json; chartset=utf-8",
            data:jsondata
        }).done(function (data) {
            Swal.fire({
                        icon: 'success',
                        title: '修改成功',
                        showConfirmButton: false,
                        timer: 1500
                        })
            $("#editEdu").hide();
            $("#createEdu").show();
            $("#eduPage").load(location.href + " #eduPage");
        })}



</script>
}





