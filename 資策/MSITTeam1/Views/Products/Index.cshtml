@model IEnumerable<MSITTeam1.ViewModels.CProductViewModel>

@{
    ViewData["Title"] = "Index";
}

@section Style{
    <link href="/css/Product.css" rel="stylesheet">
}
<div class="container">
    <form>
        <div class="form-group row justify-content-center py-4">
            <div class="col-md-5">
                <div class="input-group input-group-rounded">
                    <input type="text" placeholder="請輸入關鍵字" name="txtKeyword" class="form-control">
                    <span class="input-group-btn"><button class="btn bg-blue btn-group-right" type="submit"><i class="fas fa-search text-light"></i></button></span>
                </div>
            </div>
        </div>
    </form>

    <div class="row">
        @{ 
            foreach (var item in Model)
            {
            <div class="col-md-4 col-lg-3 text-center">
                <figure class="product-item">
                    <div class="icons">
                        <a class="add-to-cart-index" asp-action="AddToCart" asp-route-id="@item.ProductId"  title="加入購物車" style="z-index:9"><i class="fas fa-shopping-cart"></i></a>
                    </div>
                    <a class="d-block" asp-action="Details" asp-route-id="@item.ProductId">
                        <img src="@item.ImgPath" alt="" />
                    </a>
                    @*<input id="@item.ProductId" style="visibility:hidden;" value="@item.ProductId" />*@
                    <figcaption>
                        <h5>@Html.DisplayFor(modelItem => item.Name)</h5>
                        <div class="price h5">NT$@Html.DisplayFor(modelItem => item.Price, "Money")</div>
                    </figcaption>
                </figure>
            </div>
                }
            }
    </div>
    <div id="ProductPagination" class="row my-4"></div>
</div>
@section Scripts{
    <script>
        /* Demo purposes only */
        var snippet = [].slice.call(document.querySelectorAll('.hover'));
        if (snippet.length) {
            snippet.forEach(function (snippet) {
                snippet.addEventListener('mouseout', function (event) {
                    if (event.target.parentNode.tagName === 'figure') {
                        event.target.parentNode.classList.remove('hover')
                    } else {
                        event.target.parentNode.classList.remove('hover')
                    }
                });
            });
        };

        $(function () {
            initPagination('.product-item', 12, '#ProductPagination')
        });

      //判斷是否已登入
        $(".add-to-cart-index").click(function () {
            if ("@ViewBag.account" == "") {
                Swal.fire({
                    icon: 'info',
                    title: '請先登入會員',
                    showConfirmButton: false,
                    timer: 1300
                })
            } else {
                   if ("@ViewBag.account" != "") {
                Swal.fire({
                    icon: 'success',
                    title: '已加入購物車',
                    showConfirmButton: false,
                    timer: 1300
                })

                @*$.ajax({
                    url: "@Url.Content("~/Products/AddToCart")",
                    type: "POST",
                    dataType: "text",
                    data: { id: $("#@prodId").val() },
                    success: function (message) {
                        if (message == "加入購物車成功") {
                            Swal.fire("已加入購物車", "","success");
                            //$("#shopping-cart").load(location.href + " #shopping-cart");
                        }*@
                        //}).done(function (data) {
                        //    Swal.fire({
                        //        icon: 'success',
                        //        title: '已加入購物車',
                        //        showConfirmButton: false,
                        //        timer: 1300
                        //    })
                        //})
                    }
            //})
            }
        });
    </script>
}
